# 실전 프로젝트

### 구성

- 요구사항 분석 및 설계에서부터 구현까지의 모든 과정
- UML을 프로젝트에서 이용하는 방법
- 프레임워크 기반의 애플리케이션 개발
- DAO와 DO패턴의 이용
- 애플리케이션 국제화
- 애플리케이션 로깅 및 예외 처리
  - #웹 컨텍스트의 모든 에러에 대해서 전역으로 에러 처리 페이지를 설정할 수 있다.
    #웹 컨텍스트의 web.xml 설정파일에 다음 요소들로 정의한다.
    <error-page>
      <error-code></error-code><!-- 404, 500 -->
      <location></location>  
      </error-page>
      <error-page>
      <exception-type>java.lang.NullPointerException</exception-type>
      <location></location>  
      </error-page>

### 진행과정

1. 요구사항 분석
   - 유스케이스 다이어그램
   - 상세 유스케이스(좀더 세부적으로)
   - 한눈에 기능을 정리한 것
2. 설계
3. 구현 Part1
   - 차별성과 비즈니스가치는 반드시 포함
4. 구현 Part2



### 게시판의 유스케이스

- 게시물 작성
  - 비밀번호 체크(include,포함기능)
  - 사진,파일 첨부(확장기능)
- 게시물 목록
- 게시물 보기--댓글(확장)
- 게시물 수정
  - 비밀번호 체크
- 게시물 삭제
  - 비밀번호 체크



- 댓글작성- 비밀번호설정)
- 댓글 수정- 비밀번호 체크
- 댓글 삭제-비밀번호 체크

### 게시글의 데이터

- 제목

- 내용

- 작성자

- 작성일

- 조회수

- 글번호

- 첨부파일여부(멀티인지여부)

- 비밀번호체크

- 페이지수

  ```
  order by 글작성일자(글번호) desc
  where -tlwkrrmfqjsgh ~ 
  ```

  

### 댓글

-  글 번호
- 게시글번호(부모키)
- 작성자
- 내용
- 비밀번호체크

### url path 방식 경로

1. ful->http://
2. 절대경로 /board/xxx
3. 상대경로 ./list.do/xxx
4. 이러한 url path사용하는 장소
   - <a href=" ">
   - response.sendirect("  ")
   - <form.. action ="./xxxx">

### ServletContext 기준 경로

1. sc.getRequestDispatcher("/xxxx")
2. @webServlet("/xxxxxx")
3. web.xml 의 <url-pattern>/*<url-pattern> <url-pattern>/list.do<url-pattern>

###  기본게시판 만들기

##### 먼저 DB테이블설정

- 테이블 이름을 착각해서 잘못썼으니 혼자할떄는 잘해보자.

```sql
create table emaillsit(
username varchar2(20),
email varchar2(50));

insert into emaillsit values('admin','admin@korea.com');
commit;
 
 select*from emaillsit;
 
 alter table emaillsit add(no number(6));
 create sequence email_seq nocache;
 update emaillsit set no=email_seq.nextval where username='admin';
 commit;
 
 alter table emaillsit add constraint email_pk primary key(no);
 commit;
 desc emaillsit

```

##### 이클립스에서

##### EmailVO.java

```java
package lab.web.model;

public class EmailVO {
 private String username;
 private String email;
 private int no;
 
public EmailVO() {
	super();
}

public EmailVO(String username, String email,int no) {
	super();
	this.username = username;
	this.email = email;
	this.no=no;
}

public int getNo() {
	return no;
}

public void setNo(int no) {
	this.no = no;
}

public String getUsername() {
	return username;
}

public void setUsername(String username) {
	this.username = username;
}

public String getEmail() {
	return email;
}

public void setEmail(String email) {
	this.email = email;
}
 
}


```



##### EmailDAO.java를 작성

int final PAGE_SIZE=0;

//전체 게시물 수와 페이지 크기를 가지고 전체 페이지 개수 계산

//소수점에 따라 계산 상의 오류가 없도록 두 가지 중 한 가지를 이용

1.첫번째 방법

```java
	pageCount=totalCount/PAGE_SIZE:

if((totalCount % PAGE_SIZE)!=0)
pageCount++;
```

2.두번째 방법

```java
pageCount=(int)Math.ceil(totalCount/(PAGE_SIZE+0.0))
```



3.현재 페이지 그룹 설정

```java
int curGroup=(curPage-1)/GROUP_SIZE;
```

```java
package lab.web.model;

import java.io.FileInputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.Properties;

import lab.web.controller.userVO;

public class EmailDAO {
	public Connection dbCon() {
		Connection con=null;
		try {
			Properties prop=new Properties();
			prop.load(new FileInputStream("C:/workspace2/web2/WebContent/WEB-INF/db.properties"));
			Class.forName(prop.getProperty("driver"));
			con =DriverManager.getConnection(prop.getProperty("url"),
			prop.getProperty("user"),prop.getProperty("pwd"));
		}catch(Exception e) {
			e.printStackTrace();
		}
		return con;
	}
		
		public void dbClose(Connection con,Statement stat, ResultSet rs) {
			try {
				if(rs!=null)rs.close();
				if(stat!=null)stat.close();
				if(con!=null)con.close();
				
			}catch(Exception e) {
				e.printStackTrace();
			}
		}
		
	
public ArrayList<EmailVO> getList(int page,int pageSize) {
	int total=0;
	
	ArrayList<EmailVO> lists=new ArrayList();
	Connection con=null;
	PreparedStatement stat=null;
	int start=(page-1)*pageSize;//4페이지의 글 목록 31~40번글번호
	int end=page*pageSize;
	String sql="select * from emaillsit where no>"+start
			+" and no <="+end+" order by no desc";//start no보다 크고 end번호이하인 페이지 출력
	
	ResultSet rs=null;
	try {
		con=dbCon();
		stat=con.prepareStatement(sql);
		rs=stat.executeQuery();
		while(rs.next()) {
			EmailVO vo=new EmailVO(rs.getString("username")
					 ,rs.getString("email")
					 ,rs.getInt("no"));
			lists.add(vo);
		}//lists에 저장한다.
		
	}catch(Exception e) {
		e.printStackTrace();
	}finally {
		dbClose(con,stat,rs);
	}
	
	return lists;
	
}
public int getTotalCount() {
	
		int total=0;
		Connection con=null;
		PreparedStatement stat=null;
		String sql="select count(*) from emaillsit";
		ResultSet rs=null;
		try {
			con=dbCon();
			stat=con.prepareStatement(sql);
			rs=stat.executeQuery();
			if(rs.next()) {
				total=rs.getInt(1);
			}
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			dbClose(con,stat,rs);
		}
		return total;
	
}

}
```



##### list-page.jsp

```java
<%@ page contentType="text/html; charset=utf-8"   %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"  %>
<%!
	int numPerPage = 10;  //페이지 그룹내에 페이지 개수
	int numPerBlock = 10;	  //페이지내에 글 개수
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
table  {};
</style>
<title>list-page.jsp</title>
</head>
<body>
<h3> Email  등록 목록 </h3>
<table border=1 cellpadding=5 cellspacing=0>
<tr><td width=50>번호</td><td width=125>이름</td><td width=125>email</td></tr>

<!-- 이메일 목록 -->
<c:forEach var="vo" items="${headers}">
<tr><td width=50>${vo.no}</td>
<td>${vo.username}</td>
<td>${vo.email}</td></tr>
</c:forEach>
</table>

<!-- 페이지 번호 -->
<div style="text-align:center">	
<%	
	Integer p = (Integer) request.getAttribute("pageNo");
	int mypage = p.intValue();
	//출력될 페이지가 속한 페이지 그룹 계산
    int currentBlock = (int)Math.ceil(mypage / (double)numPerBlock);
	
	//전체 페이지 개수
	Integer tp = (Integer) request.getAttribute("totalPage");
	double totalPage = tp.intValue();
	
	//전체 페이지 블록 개수
	int totalBlock = (int)Math.ceil(totalPage / numPerBlock);
	
	if(totalBlock > currentBlock) { 
		int togo = (currentBlock + 1) * numPerBlock;
		if(togo > totalPage)
			togo = (int) totalPage; %>
		<a href=./list.do?page=<%=togo%>> <<다음 </a>
<%	}
	//현재 페이지 그룹의 페이지 번호 리스트
	for(int i = numPerBlock; i > 0; i--) {
		int pn = numPerBlock * (currentBlock-1) + i;
		if(pn > totalPage)
			continue;
		if(pn == mypage) { %>
		<a href=./list.do?page=<%=pn%>>
		<span style="text-decoration:underline"><%=pn%></span></a>&nbsp;
<%		} else { %>
		<a href=./list.do?page=<%=pn%>><%=pn%></a>&nbsp		
<%		}
	}
	if(currentBlock > 1) { %>
		<a href=./list.do?page=<%= (currentBlock-1)*numPerBlock %>> 이전>> </a>
<%	} %> </div> 
</div>
</body>
</html>   
```

##### ListAction.java

```java
package lab.web.model;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;


@WebServlet("/list.do")
public class ListAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
      public static int numPerBlock=10;//상수로 지정
      public static int numPerPage=10;

    public ListAction() {
        super();
        // TODO Auto-generated constructor stub
    }


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		PrintWriter out=response.getWriter();
		ServletContext sc=getServletContext();
		RequestDispatcher rd=null;
		EmailDAO dao=new EmailDAO();
		ArrayList<EmailVO>headers=null;
		String page=null;
		page=request.getParameter("page");
		
		int pageNo=1;
		int pageCount=0;
		pageCount=(int)Math.ceil(dao.getTotalCount()/(double)numPerPage);
		pageCount=Math.max(pageCount, 1);
		if(page==null) {
			
			pageNo=pageCount;
			headers=dao.getList(pageNo, numPerPage);
		}else {
			pageNo=Integer.parseInt(page);
			headers=dao.getList(pageNo, numPerPage);
			
		}
		
		request.setAttribute("headers", headers);
		request.setAttribute("pageNo", new Integer(pageNo));
		request.setAttribute("totalPage", new Integer(pageCount));
		
		rd=sc.getRequestDispatcher("/list-page.jsp");
		rd.forward(request,response);
		
	}
protected void doPost(HttpServletRequest request,HttpServletResponse response) {
	
}

	

}

```



### 본격 게시판 만들기

#### DB설정

```sql
create table userinfo(
userid varchar2(15) primary key,
userpwd varchar2(15),
username varchar2(20),
phone varchar2(15),
email varchar2(15),
address varchar2(100));


insert into userinfo (userid, userpwd, username) values ('admin', 'a1234', '관리자');
commit;

select * from userinfo;

alter table userinfo add job varchar2(15);
commit;
select * from userinfo;

create table emaillist(
username varchar2(20),
email varchar2(50)
);

insert into emaillist values('admin','admin@korea.com');

select * from emaillist;

commit;

alter table emaillist add (no number(6));

create sequence emaillist_seq nocache;

update emaillist set no = emaillist_seq.nextval where username='admin';

select * from emaillist;

commit;

alter table emaillist add constraint email_pk primary key (no);


DECLARE       
    BEGIN
       FOR i IN 1..100
       LOOP
           insert into emaillist values (DBMS_RANDOM.STRING('L',  10), concat(DBMS_RANDOM.STRING('L',  5), '@korea.com'), emaillist_seq.nextval);
       END LOOP;
       commit;
    END;  


drop table bbs purge;

create table bbs(
bid  number(6)  primary key,  --글번호
subject 	varchar2(100),    --제목
writer 		varchar2(20),     ---작성자
password 	varchar2(15),     --비밀번호
idate		date,             --작성일
contents        varchar2(2000),  --글내용
email           varchar2(50), --이메일
ip		varchar2(30), --작성자 pc ip
fileYN		char(1)   default 'N' check( fileYN in('Y','N')) ,   --file첨부 여부
rcount		number(5)  default 0,   --조회수 
vcount 		number (5)  default 0  --추천
);

drop sequence bbs_seq;
create sequence bbs_seq nocache;

drop table bbs_comment purge;

create table bbs_comment (
cmid    number(6)  primary key, 
rbid   number(6), 
writer varchar2(20), 
idate  date, 
contents  varchar2(1000), 
password   varchar2(15), 
ip      varchar2(30)
);

drop sequence comment_seq;
create sequence comment_seq nocache;


insert into bbs (bid, subject, writer, idate, contents, password, ip)
values (bbs_seq.nextval, '테스트', '게시판지기', sysdate, 
'게시판 테스트입니다', '1234', '70.12.50.130');

insert into bbs_comment (cmid, rbid, writer, idate, contents, password, ip
) values (comment_seq.nextval, -1, '관리자', sysdate, 
'댓글 테스트입니다', '1234', '70.12.50.131');
commit


select * from bbs;
select * from bbs_comment;

drop table bbs_file purge;

create table bbs_file(
fid number primary key,
rbid number,
filename varchar2(50),
filetype varchar2(15)
);

drop sequence bbsfile_seq;
create sequence bbsfile_seq nocache;

commit;

select * from bbs_file;

DELETE FROM bbs WHERE bid = 5;


alter table bbs_file add (savedfile varchar(50));

commit;
select*from bbs_file;

```

1. 테이블 bbs 생성하고 시퀀스 bbs_seq
2. 테이블 bbs_comment 시퀀스 comment_seq
3. 테이블 bbs_file 시퀀스 bbsfile_seq 
   - 각각 생성한다.
   - 시퀀스는 자동증가 컬럼으로 번호를 붙이기 위해 사용
   - `update bbs set bid=1 where writer='게시판지기';
     commit;` ` 후 확인해 보면 bid값이 1임을 확인하자
   - 라이브러리(jar)파일 추가 원할시 아파치 

#### 이클립스작업

##### EncodkingFilter.java

```java
package web.board.filter;

import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;



public class EncodingFilter implements Filter {

	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		System.out.println("utf-8로 인코딩 적용함");
		request.setCharacterEncoding("utf-8");
		chain.doFilter(request, response);
	}


	
}

```

web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd" id="WebApp_ID" version="4.0">
  <display-name>board</display-name>
   <filter>
    <filter-name>EncodingFilter</filter-name>
    <filter-class>lab.board.filter.EncodingFilter</filter-class>
  </filter>
  <filter-mapping>
    <filter-name>EncodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
  </filter-mapping> 
  <welcome-file-list> 
    <welcome-file>index.html</welcome-file>
    <welcome-file>index.htm</welcome-file>
    <welcome-file>index.jsp</welcome-file>
    <welcome-file>default.html</welcome-file>
    <welcome-file>default.htm</welcome-file>
    <welcome-file>default.jsp</welcome-file>
  </welcome-file-list>
</web-app>
```



##### COmmentVO.java

```java
package lab.board.model;

import java.sql.Date;

public class CommentVO {
	private int cmid;
	private int rbid;
	private String writer;
	private Date idate;
	private String contents;
	private String password;
	private String ip;
	public CommentVO() {
		super();
	}
	public CommentVO(int cmid, int rbid, String writer, Date idate, String contents, String password, String ip) {
		super();
		this.cmid = cmid;
		this.rbid = rbid;
		this.writer = writer;
		this.idate = idate;
		this.contents = contents;
		this.password = password;
		this.ip = ip;
	}
	public int getCmid() {
		return cmid;
	}
	public void setCmid(int cmid) {
		this.cmid = cmid;
	}
	public int getRbid() {
		return rbid;
	}
	public void setRbid(int rbid) {
		this.rbid = rbid;
	}
	public String getWriter() {
		return writer;
	}
	public void setWriter(String writer) {
		this.writer = writer;
	}
	public Date getIdate() {
		return idate;
	}
	public void setIdate(Date idate) {
		this.idate = idate;
	}
	public String getContents() {
		return contents;
	}
	public void setContents(String contents) {
		this.contents = contents;
	}
	public String getPassword() {
		return password;
	}
	public void setPassword(String password) {
		this.password = password;
	}
	public String getIp() {
		return ip;
	}
	public void setIp(String ip) {
		this.ip = ip;
	}
	 
}

```

##### BbsDAO.java

```java
package lab.board.model;

import java.io.FileInputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.Properties;



public class BbsDAO {
 public Connection dbCon() {
	 Connection con=null;
	 try{
		 Properties prop=new Properties();
		 prop.load(new FileInputStream("C:/workspace3/board/WebContent/WEB-INF/db.properties"));
		 Class.forName(prop.getProperty("driver"));
		 con=DriverManager.getConnection(prop.getProperty("url"),
					prop.getProperty("user"),prop.getProperty("pwd"));
				}catch(Exception e) {
					e.printStackTrace();
				}
				return con;
 }
 public void dbClose(Connection con, Statement stat,ResultSet rs) {
	 try {
		 if(rs!=null)rs.close();
		 if(stat!=null)stat.close();
		 if(con!=null)con.close();
	 }catch(Exception e) {
			e.printStackTrace();
		}
	}
 
 public int getPageCount(int numPerPage) {
	 	int total=0;
		Connection con=null;
		PreparedStatement stat=null;
		ResultSet rs=null;
		String sql="select count(*) from bbs";
		try {
			con=dbCon();
			stat=con.prepareStatement(sql);
			rs=stat.executeQuery();
			if(rs.next()) {
				total=rs.getInt(1);
			}
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			dbClose(con,stat,rs);
		}
		int pageCount=(int) Math.ceil(total/(double)numPerPage);
		pageCount=Math.max(pageCount, 1);
		return pageCount;
	
}
 public  int  insertComment(CommentVO prom){
	 	 int result=0;
	 	 Connection con =null;
	 	 PreparedStatement stat=null;
	 	 String sql="insert into bbs_comment(cmid,rbid,writer,idate,"
	 	 		 +" contents,password,ip) values (bbs_seq.nextval,?,?,sysdate,?,?,?)"; 
	 	 try {
	 		 con=dbCon();
	 		 stat=con.prepareStatement(sql);
	 		 stat.setInt(1, prom.getRbid());
	 		 stat.setString(2, prom.getWriter());
	 		 stat.setString(3, prom.getContents());
	 		 stat.setString(4, prom.getPassword());
	 		 stat.setString(5, prom.getIp());
	 		 result=stat.executeUpdate();
	 	 }catch (Exception e) {
	         e.printStackTrace();
	      } finally {
	         dbClose(con,stat,null);
	      }
	      return result;
 }
 
 
 
 public int insertBbs(BbsVO form) {
	  int result = 0;
      Connection con = null;
      PreparedStatement stat = null;
      String sql = "insert into bbs (bid, subject,writer,password,idate,fileYN,contents,"
            + "email,ip) values (?,?,?,?,sysdate,?,?,?,?)";
      try {
         con = dbCon();
         stat = con.prepareStatement(sql);
         stat.setInt(1, form.getBid());
         stat.setString(2, form.getSubject());
         stat.setString(3, form.getWriter());
         stat.setString(4, form.getPassword());
         stat.setString(5, form.getFileYN());
        String contents=form.getContents();
       
         stat.setString(6, contents);
         stat.setString(7, form.getEmail());
         stat.setString(8, form.getIp());
        
         result = stat.executeUpdate();
      } catch (Exception e) {
         e.printStackTrace();
      } finally {
         dbClose(con,stat,null);
      }
      return result;
   }
 
 public BbsVO getArticle(int bid) {
	 //글번호 PK로 게시글 내용 조회 리턴
	 
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 BbsVO vo= null;
	 
	 StringBuffer sql=new StringBuffer();
	 sql.append("select bid, subject,writer,password,idate,")
	 	.append(" contents,email,fileyn,ip,rcount,vcount")
	 	.append(" from bbs")
	 	.append(" where bid= ?");
	 
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql.toString(),
		 ResultSet.TYPE_FORWARD_ONLY,
		 ResultSet.CONCUR_UPDATABLE);
		 stat.setInt(1, bid);
		 rs=stat.executeQuery();
		 
		 while(rs.next()) {
			 vo=new BbsVO();
			 vo.setBid(rs.getInt("bid"));
				vo.setSubject(rs.getString("subject"));
				vo.setWriter(rs.getString("writer"));
				vo.setPassword(rs.getString("password"));
				vo.setIdate(rs.getDate("idate"));
				vo.setContents(rs.getString("contents"));
				vo.setEmail(rs.getString("email"));
				vo.setFileYN(rs.getString("fileyn"));
				vo.setIp(rs.getString("ip"));
				
				int rcount =rs.getInt("rcount");
				rs.updateLong("rcount", rcount+1);
				rs.rowUpdated();//혹은 updateInt()해도 된다
				
				
				vo.setRcount(rcount+1);
				vo.setVcount(rs.getInt("vcount"));
		 }
		 StringBuffer sql2=new StringBuffer();
		 sql2.append("select cmid, writer,idate,contents,password,")
		 	.append(" ip from bbs_comment ")
		 	.append(" where rbid= ?");
		 stat=con.prepareStatement(sql2.toString());
		 stat.setInt(1, bid);
		 rs=stat.executeQuery();
		 while(rs.next()) {
			 CommentVO ba =new CommentVO();
			 ba.setCmid(rs.getInt("cmid"));
			 ba.setRbid(bid);
			 ba.setWriter(rs.getString("writer"));
			 ba.setIdate(rs.getDate("idate"));
			 ba.setContents(rs.getString("contents"));
			 ba.setPassword(rs.getString("password"));
			 ba.setIp(rs.getString("ip"));
			 vo.addComment(ba);
		 }
		 ArrayList<FileInfoVO> files=getFileList(bid);
		 vo.setFiles(files);
				
		 }catch(Exception e) {
			 e.printStackTrace();
		 }finally {
			 dbClose(con,stat,rs);
		 }
		 return vo;
		 
	 }
	
 public ArrayList<BbsVO> getBbsList(String key,String word, int page,int numPerPage){
	 int total=0;
	 StringBuffer sql=new StringBuffer();
	 ArrayList<BbsVO> lists=new ArrayList<BbsVO>();
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 int start=(page-1)*numPerPage;//4페이지의 글 목록 31~40번글번호
	 int end=page*numPerPage;
	
	 sql.append("select num,bid,subject,writer,idate,rcount");
	 sql.append(" from (select rownum num, bid,subject,writer,idate,rcount");
	 sql.append(" from (select bid,subject,writer,idate,rcount");
	 sql.append(" from bbs where "+key+" like'"+"%"+word+"%' "+"order by bid )" );
	 sql.append(" order by num desc) where num >? and num <=? ");
	 
	 try {
			con=dbCon();
			stat=con.prepareStatement(sql.toString());
		
			stat.setInt(1, start);
			stat.setInt(2, end);
			
			rs=stat.executeQuery();
			while(rs.next()) {
				BbsVO vo=new BbsVO();
						vo.setBid(rs.getInt("bid"));
						vo.setSubject(rs.getString("subject"));
						vo.setWriter(rs.getString("writer"));
						vo.setIdate(rs.getDate("idate"));
						vo.setRcount(rs.getInt("rcount"));
						lists.add(vo);
			}
			
			}//lists에 저장한다.
			
		catch(Exception e) {
			e.printStackTrace();
		}finally {
			dbClose(con,stat,rs);
		}
		
		return lists;
				
 }
 public ArrayList<BbsVO> getBbsList(int page,int numPerPage){
	 //페이지 번호에 해당하는  게시글 10개 검색해서 리턴
	 int total=0;
		StringBuffer sql=new StringBuffer();
		ArrayList<BbsVO> lists=new ArrayList<BbsVO>();
		Connection con=null;
		PreparedStatement stat=null;
		ResultSet rs=null;
		
		int start=(page-1)*numPerPage;//4페이지의 글 목록 31~40번글번호
		int end=page*numPerPage;
		sql.append("select bid,subject,writer,idate,rcount");
		sql.append(" from (select rownum num,bid,subject,writer,idate,rcount");
		sql.append(" from bbs)");
		sql.append(" where num> ? and num<= ?");
		sql.append(" order by num desc");
		
//		sql.append("select num,bid,subject,writer,idate,");
//		sql.append(" rcount from (select bid,subject,writer,idate,rcount ");
//		sql.append(" from bbs order by bid desc) order by num desc) ");
//		sql.append(" where num>? and num<=? ");
//		sql.append("select num,bid,subject,writer,idate,rcount");
//		  sql.append(" from (select bid,subject,writer,idate,rcount") ;
//		   sql.append(" from bbs order by bid desc, num desc )where num>? and num<=?");
//		
		try {
			con=dbCon();
			stat=con.prepareStatement(sql.toString());
			stat.setInt(1, start);
			stat.setInt(2, end);
			
			rs=stat.executeQuery();
			while(rs.next()) {
				BbsVO vo=new BbsVO();
						vo.setBid(rs.getInt("bid"));
						vo.setSubject(rs.getString("subject"));
						vo.setWriter(rs.getString("writer"));
						vo.setIdate(rs.getDate("idate"));
						vo.setRcount(rs.getInt("rcount"));
						lists.add(vo);
			}
			
			}//lists에 저장한다.
			
		catch(Exception e) {
			e.printStackTrace();
		}finally {
			dbClose(con,stat,rs);
		}
		
		return lists;
		
	
 }
 
 public int updateBbs(BbsVO bbs) {
	 //제목과 내용을 수정
	 int result = 0;
     Connection con = null;
     PreparedStatement stat = null;
     String sql = "update bbs set contents = ?, subject = ? where bid = ? ";
     
     try {
        con = dbCon();
        stat = con.prepareStatement(sql);
        stat.setString(1, bbs.getContents());
        stat.setString(2, bbs.getSubject());
        stat.setInt(3, bbs.getBid());
        result = stat.executeUpdate();
     } catch (Exception e) {
        e.printStackTrace();
     } finally {
        dbClose(con,stat,null);
     }
     return result;
 }
 public int deleteCom(int cmid) {
	 String sql=null;
	 int cnt=0;
	 PreparedStatement stat=null;
	 Connection con=null;
	 sql="delete from bbs_comment where cmid=?";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql);
		 stat.setInt(1,cmid);
		 cnt+=stat.executeUpdate();
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,null);
	 }
	 return cnt;
 }

 public int deleteBbs(int bid) {
	 String sql=null,sql2=null;
	 
	 int cnt=0;
	 PreparedStatement stat=null;
	 Connection con=null;
	 sql="delete from bbs  where bid=?";
	 sql2="delete from bbs_comment  where rbid=?";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql2);
		 stat.setInt(1,bid);
		 cnt+=stat.executeUpdate();
		 
		 stat=con.prepareStatement(sql);
		 stat.setInt(1,bid);
		 cnt+=stat.executeUpdate();
		 
		 
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,null);
	 }
	 return cnt;
 }
 public String getBbsPassword(int bid) {
	 //글번호 pk로 게시글 내용 조회 리턴
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 BbsVO bbs=null;
	 String pwd=null;
	 String sql="select password from bbs where bid=? ";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql);
		 stat.setInt(1,bid);
		 rs=stat.executeQuery();
		 if(rs.next()) {
			 pwd=rs.getString("password");
		 }
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,null);
	 }
	return pwd;
 }
 public String getComPassword(int cmid) {
	 //글번호 pk로 게시글 내용 조회 리턴
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 BbsVO bbs=null;
	 String pwd=null;
	 String sql="select password from bbs_comment where cmid=? ";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql);
		 stat.setInt(1,cmid);
		 rs=stat.executeQuery();
		 if(rs.next()) {
			 pwd=rs.getString("password");
		 }
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,null);
	 }
	return pwd;
 }
 public int getBid() {
	 int bid=-1;
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 String sql="select bbs_seq.nextval from dual";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql);
		 rs=stat.executeQuery();
		 if(rs.next()) {
			 bid=rs.getInt(1);
		 }
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally{
		 dbClose(con,stat,rs);
	 }
	 return bid;
 }
 
 public ArrayList<FileInfoVO> getFileList(int rbid){
	 ArrayList<FileInfoVO> files=new ArrayList<FileInfoVO>();
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 
	 String sql="select*from bbs_file where rbid=?";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql);
		 stat.setInt(1,rbid);
		 rs=stat.executeQuery();
		 while(rs.next()) {
			 FileInfoVO file=new FileInfoVO();
			 file.setFid(rs.getInt("fid"));
			 file.setFilename(rs.getString("filename"));
			 file.setFiletype(rs.getString("filetype"));
			 file.setSavedfile(rs.getString("savedfile"));
			 file.setRbid(rs.getInt("rbid"));
			 files.add(file);
		 }
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,rs);
	 }
	 return files;
	 
	 
	 
 }
 
 public int saveFile(FileInfoVO fileinfo) {
	 //upload file정보 저장
	 StringBuffer sql=null;
	 int cnt=-1;
	 PreparedStatement stat=null;
	 Connection con=null;
	 ResultSet rs=null;
	 sql=new StringBuffer();
	 sql.append("insert into bbs_file (fid,filename,filetype,savedfile,rbid)");
	 sql.append("values (bbsfile_seq.nextval,?,?,?,?)");
	 int rbid=0;
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql.toString());
		 stat.setString(1, fileinfo.getFilename());
		 stat.setString(2, fileinfo.getFiletype());
		 stat.setString(3, fileinfo.getSavedfile());
		 stat.setInt(4, fileinfo.getRbid());
		 cnt=stat.executeUpdate();
		 
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,null);
	 }
	 return cnt;
 }
 public FileInfoVO getFile(int fid) {
	 FileInfoVO file=new FileInfoVO();
	 Connection con=null;
	 PreparedStatement stat=null;
	 ResultSet rs=null;
	 String sql="select *from bbs_file where fid=?";
	 try {
		 con=dbCon();
		 stat=con.prepareStatement(sql);
		 stat.setInt(1,fid);
		 rs=stat.executeQuery();
		 while(rs.next()) {
			 file=new FileInfoVO();
			 file.setFid(rs.getInt("fid"));
			 file.setFilename(rs.getString("filename"));
			 file.setFiletype(rs.getString("filetype"));
			 file.setSavedfile(rs.getString("savedfile"));
			 file.setRbid(rs.getInt("rbid"));
		 }
		 
		 
		 
	 }catch(Exception e) {
		 e.printStackTrace();
	 }finally {
		 dbClose(con,stat,rs);
	 }
	 return file;
 }
 
}

```



##### BbsVO.java

```java
package lab.board.model;

import java.sql.Date;

public class BbsVO {
	private int bid;
	private String subject;
	private String writer;
	private String password;
	private Date idate;
	private String contents;
	private String email;
	private String ip;
	private String fileYN;
	private int rcount;
	private int vcount;
	public BbsVO() {
		super();
	}
	
	public Date getIdate() {
		return idate;
	}

	public void setIdate(Date idate) {
		this.idate = idate;
	}

	public BbsVO(int bid, String subject, String writer, String password, Date idate, String contents, String email,
			String ip, String fileYN, int rcount, int vcount) {
		super();
		this.bid = bid;
		this.subject = subject;
		this.writer = writer;
		this.password = password;
		this.idate = idate;
		this.contents = contents;
		this.email = email;
		this.ip = ip;
		this.fileYN = fileYN;
		this.rcount = rcount;
		this.vcount = vcount;
	}

	public int getBid() {
		return bid;
	}
	public void setBid(int bid) {
		this.bid = bid;
	}
	public String getSubject() {
		return subject;
	}
	public void setSubject(String subject) {
		this.subject = subject;
	}
	public String getWriter() {
		return writer;
	}
	public void setWriter(String writer) {
		this.writer = writer;
	}
	public String getPassword() {
		return password;
	}
	public void setPassword(String password) {
		this.password = password;
	}
	
	public String getContents() {
		return contents;
	}
	public void setContents(String contents) {
		this.contents = contents;
	}
	public String getEmail() {
		return email;
	}
	public void setEmail(String email) {
		this.email = email;
	}
	public String getIp() {
		return ip;
	}
	public void setIp(String ip) {
		this.ip = ip;
	}
	public String getFileYN() {
		return fileYN;
	}
	public void setFileYN(String fileYN) {
		this.fileYN = fileYN;
	}
	public int getRcount() {
		return rcount;
	}
	public void setRcount(int rcount) {
		this.rcount = rcount;
	}
	public int getVcount() {
		return vcount;
	}
	public void setVcount(int vcount) {
		this.vcount = vcount;
	}
//	@Override
//	public String toString() {
//		
//		return "BbsVO [bid=" +bid+ ",subject=" + subject + 
//				",writer="+writer+
//				",password="+password+
//				", idate="+idate+
//				", contents="+contents+
//				",email="+email+",ip="
//				+ip+",fileYN="+fileYN+
//				",rcount="+rcount+",vcount="+vcount+"]";
//	}
}

```



##### FileInfoVO.java

```java
package lab.board.model;

public class FileInfoVO {
	private int fid;
	private int rbid;
	private String filename;
	private String filetype;
	private String savedfile;
	public FileInfoVO() {
		super();
	}
	public FileInfoVO(int fid, int rbid, String filename, String filetype, String savedfile) {
		super();
		this.fid = fid;
		this.rbid = rbid;
		this.filename = filename;
		this.filetype = filetype;
		this.savedfile=savedfile;
	}
//	@Override
//	public String toString() {
//		
//		return "FileInfoVO [fid="+fid+", rbid="+rbid+",filename="+filename+", filetype="+filetype+"]";
//	}
	public int getFid() {
		return fid;
	}
	public void setFid(int fid) {
		this.fid = fid;
	}
	public int getRbid() {
		return rbid;
	}
	public void setRbid(int rbid) {
		this.rbid = rbid;
	}
	public String getFilename() {
		return filename;
	}
	public void setFilename(String filename) {
		this.filename = filename;
	}
	public String getFiletype() {
		return filetype;
	}
	public void setFiletype(String filetype) {
		this.filetype = filetype;
	}
	public String getSavedfile() {
		
		return savedfile;
	}
	
	public void setSavedfile(String savedfile) {
		this.savedfile=savedfile;
	}
	
}

```



##### bbs_list.jsp

```jsp

<%@page import="java.util.Vector"%> 
<%@ page contentType="text/html;charset=utf-8" %> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%!
	//int numPerPage = BbsListAction.numPerPage;
	//int numPerBlock = BbsListAction.numPerBlock;
	int numPerPage = 10;
	int numPerBlock = 10;
	 
%>
<html><head><title>게시판</title>
<script>
 
</script>
</head>
<link href="mystyle.css" rel="stylesheet" type="text/css">
<body><h3 id="header">게시판</h3>

<div id='menu'>
<%@ include file="mymenu.jsp" %>
</div>

<div id="main">
<table width=100%>
	<tr><th>번호</th><th>제목</th><th>작성자</th>
		<th>작성일</th><th>조회수</th></tr>
<c:forEach var="row" items="${headers}">
	<tr><td colspan=5 height=1 background=./image/dotline.gif></td></tr>
	<tr><td>${row.bid} </td><td>		 
		<a href="./view.do?bid=${row.bid}%page=${pageNo}">${row.subject}</a>
		</td>
		<td>${row.writer}</td>
		<td>${row.idate}</td>
		<td style='text-align:right'>${row.rcount}</td>
		<!-- 답글 -->
 
</c:forEach>
<tr><td colspan=5 height=1 background=./image/dotline.gif></td></tr>
</table>
<div style='text-align:right'><br><br>
	<a href=./write.do>글작성</a>
</div>
<!-- 페이지 번호 -->
	<div style="text-align:center">	
<%	
	Integer p = (Integer) request.getAttribute("pageNo");
	int mypage = p.intValue();
    int currentBlock = (int)Math.ceil(mypage / (double)numPerBlock);
	Integer tp = (Integer) request.getAttribute("totalPage");
	double totalPage = tp.intValue();
	int totalBlock = (int)Math.ceil(totalPage / numPerBlock);
	if(totalBlock > currentBlock) { 
		int togo = (currentBlock + 1) * numPerBlock;
		if(togo > totalPage)
			togo = (int) totalPage; %>
		<a href=./list.do?page=<%=togo%>> << </a>
<%	}
	for(int i = numPerBlock; i > 0; i--) {
		int pn = numPerBlock * (currentBlock-1) + i;
		if(pn > totalPage)
			continue;
		if(pn == mypage) { %>
		<a href=./list.do?page=<%=pn%>>
		<span style="text-decoration:underline"><%=pn%></span></a>&nbsp;
<%		} else { %>
		<a href=./list.do?page=<%=pn%>><%=pn%></a>&nbsp		
<%		}
	}
	if(currentBlock > 1) { %>
		<a href=./list.do?page=<%= (currentBlock-1)*numPerBlock %>> >> </a>
<%	} %> </div> 
</div>

</body>
</html>
```



##### bbs_write.jsp

```jsp
<%@ page language="java" contentType="text/html;charset=utf-8" %> 



<!DOCTYPE html>
<html><head><title>게시판 글 작성</title></head>
<link href="mystyle.css" rel="stylesheet" type="text/css">
<body><h3 id="header">게시판 글 작성</h3>

<form method='post' action='./write.do'>
<table width='100%'>
 
<tr><td>제목</td><td><input type='text' name='subject' size="50"></td></tr>

	<tr><td>이름</td>
		<td><input type='text' name='writer'  ></td></tr>
	<tr><td>암호</td>
		<td><input type='password' name='password' ></td></tr>
	<tr><td>Email</td>
		<td><input type='text' name='email' size="50"></td></tr>
	


<tr><td>내용</td><td>
<textarea cols='65' name='contents' rows='20'></textarea>
</td></tr>


 
 
<tr><td>파일 첨부 </td>
		<td><input type='file' name='upload' multi></td></tr>
 	
<tr><td colspan='2' align='center'>
<a href="./list.do">글록록</a>
<input type='submit' value="글쓰기 저장" > 
<input type='reset' value="글쓰기 취소" >
</td></tr>
</table>
</form>



</body>
</html>

```



##### mymenu.jsp

```jsp
<%@ page contentType="text/html;charset=utf-8" %>
<div id="menucontainer">
	<div id="shatop"></div>
	<h3 class="center">메 뉴</h3>
	<a href=logout.jsp>로그아웃</a>
	<div class="blank">&nbsp;</div>
	<a href=viewuser.jsp>정보수정</a>
	<div class="blank">&nbsp;</div>
	<a href=notice.jsp>공지사항</a>
	<div class="blank">&nbsp;</div>
	<a href=user_list.jsp>회원목록</a>
	<div class="blank">&nbsp;</div>
	<a href=cabinet.jsp>문서관리</a>
	<div class="blank">&nbsp;</div>	
	<a href=Mail>전자메일</a>
	<div class="blank">&nbsp;</div>
	<a href=bbs.do>게 시 판</a>
	<div class="blank">&nbsp;</div>
	<div class="blank">&nbsp;</div>		
	<h3 class="center">방문자</h3>
	<div class="blank">&nbsp;</div>
	<div class="blank">&nbsp;</div>		
	
	</div>
</div>
```



##### mystyle.css

```jsp
body { 
	margin-top: 0;
	margin-bottom: 0;
	margin-left: 0;
	margin-right: 0;
	padding-left: 0;
	padding-right: 0;
	background-color:#ececec;
}

.center {
	text-align: center
}

.line {
	font-size : x-small;
	font-family: 굴림, arial, "lucida console", sans-serif;
	text-align : center;
}
/*
a { 
	text-decoration:none;
	color:#C9CA6D;
}

a:hover {
	color:#757678;
	text-decoration:underline;
}
*/
#header {
	margin: 5px;
	padding: 5px;
	height: 200px;
	background-image: url('image/back.jpg');
	text-align: center;
	font-weight: bolder;
}

#menu {
	position: absolute;
	left: 5px;
	top: 220px;
	width: 100px;  	
	padding-left: 5;
	padding-right: 5;
	background:#fff;
	border-right:1px #ececec solid;
	border-left:1px #ececec solid;	
}

#menucontainer {
	border-right:1px #ececec solid;
	border-left:1px #ececec solid;
}

#menu a {
	display:block;
	text-decoration:none;
	color:#87ACBB;
	padding-left:5px;
	width:100px;
	background:#fff;
}

#menu a:hover {
	color:#fff;
	background:#C3D3E2;
}

#menu h3 {
	display:block;
	width:100px;
	color: #fff;
	background:#A26B6B;
	border-right:3px solid #A26B6B;
	font-weight: bolder;	
}

#main {
	top: 0;
	padding: 5px;
	height: 100%;
	margin-left: 125px;
	margin-right: 5px;
	background:#fff ;
	border:1px #bcbcbc solid;
}

#shabottom {
	float:right;
	background:transparent url(image/shabottom.gif) bottom no-repeat;
	margin:auto;
	padding:0;
	height:5px;
	width:100px;
	font:1px/5px "Georgia",serif;
}

#shatop {
	background:transparent url(image/shatop.gif) top no-repeat;
	margin:0;
	padding:0;
	width:100px;
	height:5px;
	font:1px/5px "Georgia",serif;
	float:right;
}

.blank {
	clear:both;
	float:none;
	font-size:10px;
	color:#FFF;
}

.button {
	width: 100px;
	text-align:center;
	text-decoration:none;
	padding-top: 2;
	padding-bottom: 2;
	padding-left: 5;
	padding-right: 5;
	background: #ececec;
	border-top:1px #ececec solid;
	border-bottom:1px #acacac solid;
	border-right:1px #acacac solid;
	border-left:1px #ececec solid;	
}
```



##### simple.css

```jsp
h1, h2, h3 {
	text-align: center
}
/*
a:hover {
	background:#C3D3E2;
}
*/
#header {
	background-image:url(image/bgWood.jpg);
    text-align: center;
	font-weight: bolder;
}
#menu {
	border : 1px #ececec dotted
}
#main {
	padding-top : 10px;
	border-top : 1px #AAA solid	
}
.blank {
	display: none;
}
```

##### BoardAction.java

```java
package lab.board.controller;

import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.Collection;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.Part;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;
import lab.board.model.FileInfoVO;


@WebServlet("/write.do")

public class BoardAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
      public static int numPerBlock=10;
      public static int numPerPage=10;
  
    public BoardAction() {
        super();
        // TODO Auto-generated constructor stub
    }

	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
	    
		response.sendRedirect("./bbs_write.jsp");

	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	 response.setCharacterEncoding("text/html;charset=utf-8");
	 request.setCharacterEncoding("utf-8");
	 PrintWriter out=response.getWriter();
	 BbsDAO dao= new BbsDAO();
	 BbsVO form=null;
	 String page=null;
	 page=request.getParameter("page");
	 form=new BbsVO();
	 String fileFlag="N";
	 if(request.getParameter("upload")!=null){
		 fileFlag="Y";
		 //upload된 파일 저장 처리
	 }
	 form.setFileYN(fileFlag);
	 form.setWriter(request.getParameter("writer"));
	 form.setPassword(request.getParameter("password"));
	 form.setSubject(request.getParameter("subject"));
	 form.setEmail(request.getParameter(("email")));
	 form.setEmail(request.getParameter("contents"));
	 form.setContents(request.getRemoteAddr());
	 if(dao.insertBbs(form)>0) {
		 response.sendRedirect("./list.do");
	 }
	}
//	public void uploadProc(HttpServletRequest request,HttpServletResponse response) throws ServletException, IOException {
//	BbsDAO dao=new BbsDAO();
//	String path="c:uploadtest";
//	File isDir=new File(path);
//	String saveFile=null;
//	if(!isDir.isDirectory()) {
//		isDir.mkdirs();
//	}
//	Collection<Part> parts =request.getParts();
//	for(Part part: parts) {
//		if(part.getContentType()!=null) {
//			String fileName=part.getSubmittedFileName();
//			if(fileName!=null) {
//				saveFile=fileName.substring(0,fileName.lastIndexOf("."))
//						+"_"+System.currentTimeMillis()+fileName.substring(fileName.lastIndexOf("."));
//				
//				part.write(saveFile);
//				
//				System.out.println("file저장");
//				FileInfoVO file=new FileInfoVO();
//				//file.setRbid();
//				file.setFilename(saveFile);
//				String fileType=fileName.substring(fileName.lastIndexOf("."));
//				
//				file.setFiletype(fileType);
//				//dao.insertUploadFile(file);
//				
//					
//				
//			}
//		}
//	}
//	}

}

```

##### listAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;


@WebServlet("/list.do")
public class ListAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
      public static int numPerBlock=10;//상수로 지정
      public static int numPerPage=10;

    public ListAction() {
        super();
        // TODO Auto-generated constructor stub
    }


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("utf-8");
		response.setContentType("text/html;charset=utf-8");
		doPost(request,response);
		
		
		
		
	}
protected void doPost(HttpServletRequest request,HttpServletResponse response) throws ServletException,IOException {
	response.setContentType("text/html/charset=utf-8");
	request.setCharacterEncoding("utf-8");
	
	ServletContext sc=getServletContext();
	RequestDispatcher rd= null;
	BbsDAO dao=new BbsDAO();
	ArrayList<BbsVO> headers=null;
	String page=null;
	page=request.getParameter("page");
	int pageNo=1;
	if(page==null) {
		pageNo=dao.getPageCount(numPerPage);
		headers=dao.getBbsList(pageNo,numPerPage);
	}else {
		pageNo=Integer.parseInt(page);
		headers=dao.getBbsList(pageNo,numPerPage);
	}
	Integer totalPage=new Integer(dao.getPageCount(numPerPage));
	request.setAttribute("headers", headers);
	request.setAttribute("pageNo", new Integer(pageNo));
	request.setAttribute("totalPage", totalPage);
	rd=sc.getRequestDispatcher("/bbs_list.jsp");
	rd.forward(request, response);
	
}

	

}

```

##### BbsView.jsp

```jsp
<%@ page contentType="text/html;charset=utf-8" %> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib uri = "http://java.sun.com/jsp/jstl/functions" prefix = "fn" %>

<html><head><title>게시판 읽기</title></head>
<link href="mystyle.css" rel="stylesheet" type="text/css">
<script>
  function show(cmd, url) {
	var d = document.getElementById('enter');
	d.style.display = 'block';
	var form = document.forms.my;	
	form.attributes.action.value = url;//넘어온 url를 action.value로 설정
	form.action.value = cmd;
	if(cmd == 'modify') {
		form.submit.value = '글 수정';//submit.value를 글 수정으로 변경
	} else if(cmd == 'delete' ) {
		form.submit.value = '글 삭제';
	}
  }
  
  function hide() {
	var d = document.getElementById('enter');
	d.style.display = 'none';  
  }
  
  var init = false;
  function edit() {
  	var d = document.getElementById('comment');
	if(init == false) {
		d.contents.value='';
		init = true;
	}
  }
  
  function vote() {
  	var win = open('vote.html','w','width=200,height=200');
  }
  
  function mydelete(id) {
  	var d = document.getElementById(id);
	d.style.display = 'block';
	var bttn = 'b' + id;
	var b = document.getElementById(bttn);
	b.style.display = 'none';
  }
</script>
<body>

<c:if test='${not empty user}'>
<div style='text-align:right; font-size:small;'>
${user.username}(${user.userid})님 로그인 중 &nbsp;&nbsp;&nbsp;&nbsp;

<a href=" " style='font-size:small;'>회원 정보 수정</a>&nbsp;&nbsp;&nbsp;
</div>
</c:if>

<h3 id="header">글 내용 읽기 (게시판)</h3>
<div id='menu'>
<%@ include file="mymenu.jsp" %>
</div>
<div id="main">
<table width=100%> 
<!--게시물-->
	<tr><td>
	<b>제목 : ${article.subject} </b><br>
	작성자 : <a href=mailto:${article.email}>${article.writer}</a> 
			 &nbsp;<span style='font-size : 80%'>
			 <a href="mailto:"+${article.email}>${article.email}</a>
			 </span> <br>
	작성일 : ${article.idate}<br>
	조회수 : ${article.rcount} &nbsp; &nbsp;  
	추천수 : ${article.vcount} &nbsp;
	<span style='font-size:70%'>	
	<a href=./vote.do?bid=${article.bid} 
		onClick='vote()' target='w'>추천하기</a>
	</span>
	<br>
	</td></tr>
	<tr><td colspan=2 height=1 background=./image/dotline.gif></td></tr>
	<tr><td colspan=2><br>	
	<c:set var="contents1" value="${article.contents}" />
	<c:set var="newLine" value="\n" />
	<c:set var = "contents2" value = "${fn:replace(contents1, newLine , '<br>')}" />	 
     ${contents2 }
	 
	 <br><br>
	</td></tr>


<!-- 파일 업로드 테스트-->
	 
	 <br><br>
	</td></tr>
	<tr><td colspan=2 height=1 background=./image/dotline.gif></td></tr>
	<tr><td>첨부 파일 :</td>	
	<td>
	<c:forEach var="file" items="${article.files}">
	<a style="text-align:left;" href="./fileview.do?fid=${file.fid}">${file.filename}</a><br>
	</c:forEach>
	</td> </tr>
	<tr><td colspan=2 height=1 background=./image/dotline.gif></td></tr>
</table>

<table width='100%'> 
<!-- 메뉴 -->
<tr><td><div class='button'><a href=./list.do>목록보기</a></div></td>
 
	 
	<td><div class='button'>
	<a href="javascript:show('modify',
		'./modify.do?bid=${article.bid}&page=${page}')">수정하기</a>
	</div></td>
	 	
	<td><div class='button'>
	<a href="javascript:show('delete','./delete.do?bid=${article.bid}&page=${page}')">삭제하기</a>
	</div></td>
 
 
	<td><div class='button'>
	<a href="./write.do">글쓰기</a>
	</div></td></tr>
</table>







<!-- 글 수정 및 삭제를 위한 암호 입력 -->
<div id='enter' style='display:none'>
	<form method=post action='' name='my'>
	암호 <input type=password name=password size=5>
	<input type=hidden  name='bid' value='${article.bid}'>
	
	<input type=hidden  name='page' value='${pageNo}'>
	<input type=submit name='submit' value=''>
	<input type=reset name='reset' value='숨기기' onClick='hide()'>
	</form>
</div>

<!-- 댓글 읽기 -->
<table width='99%'>
<c:forEach var="comment" items="${article.comments}">
	<tr><td colspan=2 height=1 background=./image/dotline.gif></td></tr>
	<tr><td width=100>
	 <b>${comment.writer}</b><br>
	 <span style='font-size:70%'>${comment.idate}<br>
	 ${comment.ip} &nbsp; &nbsp;	
	 <button id='b${comment.cmid}' 
	 	onClick='mydelete(${comment.cmid})'>x</button>	
	 </span>
	 <!-- 댓글 삭제 폼 -->
	 <span id='${comment.cmid}' style='display:none'>
	 <form method=post action=./delete_comment.do>	 
	 암호 <input type=password name=password size=5>
		<input type=hidden name='cmid' value='${comment.cmid}'>
		<input type=hidden name='bid' value='${article.bid}'>
		<input type='hidden' name='page' value='${page}'>
		<input type=submit value='삭제'>
		</form>	 
	 </span>
	 </td><td>${comment.contents}</td></tr>
</c:forEach>
<tr><td colspan=2 height=1 background=./image/dotline.gif></td></tr>
</table>

<!-- 댓글쓰기 -->
<form id='comment' action='./comment.do' method='post'>
<input type='hidden' name='bid' value='${article.bid}'>
<input type='hidden' name='page' value='${page}'><!-- 부모글을 위해서 page가 필요하다 -->
<div style='text-align:center'>
<table width='95%'>
	<tr><td align=center>
	<textarea name='contents' cols='65' rows='5' onFocus='edit()'>
댓글을 작성해주세요
	</textarea>
	</td></tr>
	<tr><td align=right>
	이름<input type='text' name='writer' size='10'> 
	암호<input type='password' name='password' size='10'>
	<input type='submit' value='저장'></td></tr>
</table>
</div>  
</form>
</div>
</body>
</html>



```



##### BbsModifyAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;


@WebServlet("/modify.do")
public class BbsModifyAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
  
    public BbsModifyAction() {
        super();
        // TODO Auto-generated constructor stub
    }

	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		request.setCharacterEncoding("utf-8");
		doPost(request,response);
	}

	
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		 response.setContentType("text/html;charset=utf-8");
		 request.setCharacterEncoding("utf-8");
		 PrintWriter out=response.getWriter();
		 ServletContext sc=getServletContext();
		 RequestDispatcher rd=null;
		 BbsDAO dao=new BbsDAO();
		int bid=Integer.parseInt(request.getParameter("bid"));
		String page=request.getParameter("page");
		String passwd=request.getParameter("password");
		BbsVO article=null;
		article=dao.getArticle(bid);
		 if(article!=null && article.getPassword().equals(passwd)) {
			 request.setAttribute("article", article);
			 request.setAttribute("bid", new Integer(bid));
			 request.setAttribute("page", page);
			 rd=sc.getRequestDispatcher("/bbs_edit.jsp");
			 rd.forward(request, response);
	
		 }else {
			 out.print("<script>");
			 out.print("alert(\"패스 워드 오류\");");
			 out.print("location.href=\"./view.do?bid="+bid+"&page="+page+"\";");
			 out.print("</script>");
			
		 }
	}

}

```

##### BbsRemoveAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;


@WebServlet("/delete.do")
public class BbsRemoveAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
   
    public BbsRemoveAction() {
        super();
        // TODO Auto-generated constructor stub
    }

	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		PrintWriter out =response.getWriter();
		BbsDAO dao=new BbsDAO();
		BbsVO form=null;
		String page=null;
		page=request.getParameter("page");
		int bid=Integer.parseInt(request.getParameter("bid"));
		String password=request.getParameter("password");
		if(password.equals(dao.getBbsPassword(bid))) {
		if(dao.deleteBbs(bid)>0) {
			response.sendRedirect("./list.do?page="+page);
		}
		
		}else {
			out.print("<script>");
			out.print("alert(\"패스워드 오류\");");
			out.print("location.href=\"./view.do?bid="+bid+"&page="+page+"\";");
			out.print("</script>");
		}
	}

}

```

##### BbsupdateAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;


@WebServlet("/update.do")
public class BbsUpdateAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
   
    public BbsUpdateAction() {
        super();
        // TODO Auto-generated constructor stub
    }


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		doPost(request,response);
		
	}

	
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		PrintWriter out=response.getWriter();
		ServletContext sc=getServletContext();
		BbsDAO dao=new BbsDAO();
		BbsVO form= null;
		
		String page=request.getParameter("page");
		System.out.println(page);
		int bid=Integer.parseInt(request.getParameter("bid"));
		form=new BbsVO();//비운 상태에서 뼈대를 구축해놓는다.
		form.setBid(bid);
		form.setSubject(request.getParameter("subject"));
		form.setContents(request.getParameter("contents"));
		
		if(dao.updateBbs(form)>0) {
			response.sendRedirect("./view.do?bid="+bid+"&page="+page);
			
		}
	}

}

```

##### BbsViewAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;


@WebServlet("/view.do")
public class BbsViewAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
   
    public BbsViewAction() {
        super();
        
    }

	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		request.setCharacterEncoding("utf-8");
		doPost(request,response);
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		 response.setContentType("text/html;charset=utf-8");
		 request.setCharacterEncoding("utf-8");
		 PrintWriter out=response.getWriter();
		 ServletContext sc=getServletContext();
		 RequestDispatcher rd=null;
		 BbsDAO dao=new BbsDAO();
		int  num=Integer.parseInt(request.getParameter("bid"));
		String page=request.getParameter("page");
		BbsVO article=null;
		article=dao.getArticle(num);
		
		 if(article!=null) {
			 request.setAttribute("article", article);
			 request.setAttribute("bid", new Integer(num));
			 request.setAttribute("page", new Integer(page));
			 rd=sc.getRequestDispatcher("/BbsView.jsp");
			 rd.forward(request, response);
		 }else {
			 out.print("<script>");
			 out.print("alert(\"글 내용 조회 실패\");");
			 out.print("locaton.href=\"./list.do\"");
			 out.print("</script>");
		 }
		 
		 
		 
		 
		 
		 
		 
		 
		
	}

}

```

##### bbs_edit.jsp

```java
<%@ page contentType="text/html;charset=utf-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
 
<html><head><title>게시판 글 수정</title></head>
<link href="mystyle.css" rel="stylesheet" type="text/css">
<body><h3 id="header">게시판 글 수정</h3>
<div id='menu'>
<%@ include file="mymenu.jsp" %>
</div>
<div id="main">
<form method='post' action='update.do'>
 
 
<table width='100%'>
 
 
<tr><td>제목</td><td>
   <input type='text' name='subject' value='${article.subject}'>
</td></tr>
 
  <tr><td>이름</td><td>
	  <input type='text' name='writer' value='${article.writer}' >
  </td></tr>
  <tr><td>암호</td><td>
    <input type='password' name='password' value='${article.password}'>
  </td></tr>
  <tr><td>Email</td><td>
   <input type='text' name='email' value='${article.email}'></td>
  </tr>
  
 
<tr><td>내용</td><td>
  <textarea cols='65' name='contents' 
            rows='20'>${article.contents}</textarea>
</td></tr>
<tr><td colspan='2' align='center'>
<input type='hidden' name='bid' value='${article.bid}'>
<input type='hidden' name='page' value='${page}'>
<input type='submit' value="글 수정 저장"> <input type='reset' value="글 수정 취소">
</td></tr>
</table>
</form>
</div>
</body>
</html>

```

##### BbsCommentAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.CommentVO;


@WebServlet("/comment.do")
public class BbsCommentAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
   
    public BbsCommentAction() {
        super();
        // TODO Auto-generated constructor stub
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		doPost(request,response);
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		request.setCharacterEncoding("utf-8");
		PrintWriter out=response.getWriter();
		BbsDAO dao=new BbsDAO();
		
		CommentVO prom=null;
		prom=new CommentVO();
		String page=null;
		page=request.getParameter("page");
		int num=Integer.parseInt(request.getParameter("bid"));
		prom.setRbid(num);
		prom.setContents(request.getParameter("contents"));
		prom.setWriter(request.getParameter("writer"));
		prom.setPassword(request.getParameter("password"));
		
		
		
		if(dao.insertComment(prom)>0) {
			response.sendRedirect("./view.do?bid="+num+"&page="+page);
		}
		
		
		
		
		
	}

}

```



##### BbsSerachAction.java

```java
package lab.board.controller;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import lab.board.model.BbsDAO;
import lab.board.model.BbsVO;


@WebServlet("/search.do")
public class BbsSerachAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
	   public static int numPerBlock=10;//상수로 지정
	      public static int numPerPage=10;
  
    public BbsSerachAction() {
        super();
        // TODO Auto-generated constructor stub
    }


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		request.setCharacterEncoding("utf-8");
		doGet(request, response);
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8");
		request.setCharacterEncoding("utf-8");
		
		
		ServletContext sc=getServletContext();
		RequestDispatcher rd= null;
		BbsDAO dao=new BbsDAO();
		ArrayList<BbsVO> headers=null;
		String page=null;
		page=request.getParameter("page");
		String searchKey=null; String searchWord=null;
		searchKey=request.getParameter("searchKey");
		searchWord=request.getParameter("searchWord");
		int pageNo=1;
		if(page==null) {
			pageNo=dao.getPageCount(numPerPage);
			headers=dao.getBbsList(searchKey,searchWord,pageNo,numPerPage);
		}else {
			pageNo=Integer.parseInt(page);
			headers=dao.getBbsList(searchKey,searchWord,pageNo,numPerPage);
		}
		Integer totalPage=new Integer(dao.getPageCount(numPerPage));
		request.setAttribute("headers", headers);
		request.setAttribute("pageNo", new Integer(pageNo));
		request.setAttribute("totalPage", totalPage);
		rd=sc.getRequestDispatcher("/bbs_list.jsp");
		rd.forward(request, response);
		
	}

}

```

BbsFileView Aaction.java

```java
package lab.board.controller;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileReader;
import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;



import lab.board.model.BbsDAO;
import lab.board.model.FileInfoVO;


@WebServlet("/fileview.do")
public class BbsFileViewAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       

    public BbsFileViewAction() {
        super();
        // TODO Auto-generated constructor stub
    }


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("utf-8");
		response.setContentType("text/html;charset=utf-8");
		int fid=Integer.parseInt(request.getParameter("fid"));
		BbsDAO dao=new BbsDAO();
		FileInfoVO file=dao.getFile(fid);
		BufferedReader reader=null;
		if(file.getFiletype().equalsIgnoreCase("jpg")||
		file.getFiletype().equalsIgnoreCase("gif")||
        file.getFiletype().equalsIgnoreCase("png")||
         file.getFiletype().equalsIgnoreCase("jpeg")){
	      response.setContentType("application/octet-stream;charset=utf-8");
	      OutputStream os=response.getOutputStream();
	      File f=new File("c://uploadtest/",file.getSavedfile());
	
	//헤더에 파일이름 용량을 설정
	response.setHeader("Content-Disposition", "attachment;filename"+f.getName());
	response.setHeader("Content-Length", ""+f.length());
	FileInputStream fis=new FileInputStream(f);
	int readCount=0;
	byte[] buf=new byte[1024];
	while((readCount=fis.read(buf))!=1) {
		os.write(buf,0,readCount);
	}
	fis.close();
	os.close();
}else {
	
	PrintWriter out=response.getWriter();
	reader=new BufferedReader(new FileReader("c://uploadtest/"+file.getSavedfile()));
	while(true) {
		String str=reader.readLine();
		if(str==null)
			break;
		out.print(str+"</br>");
	}
}
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}


```











